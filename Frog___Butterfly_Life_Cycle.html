<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Life Cycles Adventure</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Comic Sans MS', cursive, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:20px; }
        .container { max-width:1000px; margin:0 auto; background:#fff; border-radius:20px; padding:30px; box-shadow:0 10px 40px rgba(0,0,0,.3); }
        h1 { text-align:center; color:#764ba2; font-size:2.5em; margin-bottom:10px; }
        .subtitle { text-align:center; color:#667eea; font-size:1.3em; margin-bottom:30px; }
        .score-board { display:flex; justify-content:space-around; margin-bottom:30px; padding:20px; background:linear-gradient(135deg,#56ab2f 0%,#a8e063 100%); border-radius:15px; color:#fff; font-size:1.3em; font-weight:bold; }
        .nav-buttons { display:flex; justify-content:center; gap:15px; margin-bottom:30px; flex-wrap:wrap; }
        .nav-btn { padding:15px 30px; font-size:1.1em; border:none; border-radius:50px; cursor:pointer; font-weight:bold; transition:.3s; font-family:'Comic Sans MS', cursive; color:#fff; }
        .nav-btn:hover { transform:scale(1.1); }
        .learn-btn { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
        .game-btn { background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%); }
        .test-btn { background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%); }
        .section { display:none; }
        .section.active { display:block; animation:fadeIn .5s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        .lesson-box { background:linear-gradient(135deg,#e0f7fa 0%,#80deea 100%); padding:25px; border-radius:15px; margin-bottom:20px; }
        .lifecycle-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; margin:20px 0; }
        .stage-box { background:#fff; padding:20px; border-radius:15px; text-align:center; border:4px solid #ddd; }
        .stage-emoji { font-size:3em; margin:15px 0; }
        .stage-number { background:#764ba2; color:#fff; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:bold; }
        .game-area { background:#f5f5f5; padding:30px; border-radius:15px; margin:20px 0; }
        .draggable-item { display:inline-block; padding:15px 25px; margin:10px; background:#ffd54f; border-radius:15px; cursor:move; font-size:1.1em; border:3px solid #ff8f00; user-select:none; }
        .drop-zone { min-height:80px; border:4px dashed #ccc; border-radius:15px; padding:15px; margin:10px 0; background:#fff; }
        .btn { padding:12px 30px; font-size:1.1em; border:none; border-radius:25px; cursor:pointer; font-weight:bold; margin:10px 5px; font-family:'Comic Sans MS', cursive; }
        .btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
        .btn-success { background:linear-gradient(135deg,#56ab2f 0%,#a8e063 100%); color:#fff; }
        .btn:hover { transform:translateY(-2px); }
        .feedback { padding:20px; border-radius:15px; margin:20px 0; font-size:1.3em; text-align:center; font-weight:bold; display:none; }
        .feedback.correct { background:#c8e6c9; color:#2e7d32; border:3px solid #2e7d32; display:block; }
        .feedback.incorrect { background:#ffcdd2; color:#c62828; border:3px solid #c62828; display:block; }
        .question-box { background:#fff; padding:25px; border-radius:15px; margin:20px 0; border:3px solid #ddd; }
        .answer-option { display:block; padding:15px; margin:10px 0; background:#f5f5f5; border:3px solid #ddd; border-radius:10px; cursor:pointer; font-size:1.1em; }
        .answer-option:hover { background:#e0e0e0; }
        .answer-option.selected { background:#bbdefb; border-color:#1976d2; font-weight:bold; }
        .progress-bar { width:100%; height:30px; background:#e0e0e0; border-radius:15px; margin:20px 0; }
        .progress-fill { height:100%; background:linear-gradient(135deg,#56ab2f 0%,#a8e063 100%); transition:width .5s; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; border-radius:15px; }
        .matching-card { display:inline-block; padding:20px; margin:10px; background:#fff; border:3px solid #ddd; border-radius:15px; cursor:pointer; font-size:1.1em; min-width:120px; text-align:center; }
        .matching-card.selected { background:#bbdefb; border-color:#1976d2; }
        .matching-card.correct { background:#81c784; border-color:#2e7d32; color:#fff; }
        .inline-row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:10px 0 20px; }
        .inline-row input { padding:10px 14px; border-radius:10px; border:2px solid #ddd; font-size:1em; }
        .status { font-size:.95em; color:#555; margin-top:8px; display:none; }
        .status.ok { color:#1b5e20; display:block; }
        .status.err { color:#b71c1c; display:block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê∏ü¶ã Life Cycles Adventure! üå±‚ú®</h1>
        `;
                q.options.forEach(option => {
                    const opt = document.createElement('div');
                    opt.className = 'answer-option';
                    opt.textContent = option;
                    opt.onclick = () => selectAnswer(i, option, opt);
                    qBox.appendChild(opt);
                });
                container.appendChild(qBox);
            });

            document.getElementById('test-results').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
            updateTestProgress();
        }

        function selectAnswer(questionIndex, answer, element) {
            const siblings = element.parentElement.querySelectorAll('.answer-option');
            siblings.forEach(s => s.classList.remove('selected'));
            element.classList.add('selected');
            testAnswers[questionIndex] = answer;
            updateTestProgress();
        }

        function updateTestProgress() {
            const answered = Object.keys(testAnswers).length;
            const progress = document.getElementById('test-progress');
            progress.style.width = (answered / 12 * 100) + '%';
            progress.textContent = `${answered}/12`;
        }

        async function submitTest() {
            if (Object.keys(testAnswers).length < 12) { alert('Please answer all questions!'); return; }

            let correct = 0;
            testQuestions.forEach((q, i) => { if (testAnswers[i] === q.answer) correct++; });

            document.getElementById('final-score').textContent = correct;
            const message = document.getElementById('final-message');

            if (correct >= 10) { message.textContent = 'üèÜ WOW! You\'re a Life Cycle Expert!'; addPoints(120); }
            else if (correct >= 8) { message.textContent = '‚≠ê Great job! You know your life cycles!'; addPoints(80); }
            else if (correct >= 6) { message.textContent = 'üëç Good work! Keep learning!'; addPoints(60); }
            else { message.textContent = 'üí™ Let\'s review and try again!'; }

            document.getElementById('test-results').style.display = 'block';
            document.getElementById('submit-btn').style.display = 'none';

            // === AUTO-SEND EMAIL ON SUBMIT ===
            const details = buildAnswersDetail();
            await sendResultsEmail(correct, details);
        }

        function retakeTest() { initTest(); }

        function addPoints(points) {
            score += points; stars += 1;
            document.getElementById('score').textContent = score;
            document.getElementById('stars').textContent = stars;

            if (score >= 300) document.getElementById('level').textContent = 'Life Cycle Master! üèÜ';
            else if (score >= 200) document.getElementById('level').textContent = 'Expert Scientist! ‚≠ê';
            else if (score >= 100) document.getElementById('level').textContent = 'Nature Detective! üîç';
        }

        // init
        initTest();
    </script>
</body>
</html>
