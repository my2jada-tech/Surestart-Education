<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Judaism ‚Äì Study Guide + Assessment (EmailJS)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#fff7ed; --bg2:#fff1f2; --bg3:#f0f9ff;
      --ink:#1f2937; --muted:#6b7280;
      --indigo:#4f46e5; --pink:#db2777; --rose:#e11d48; --teal:#0d9488; --emerald:#059669;
      --amber:#f59e0b;
      --green:#16a34a; --red:#dc2626; --yellow:#f59e0b;
      --card:#ffffff; --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));color:var(--ink);}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:24px;border:1px solid var(--border);}
    h1{font-weight:800;margin:.2rem 0 0.4rem}
    h2{margin:0.2rem 0 0.4rem}
    .row{display:flex;gap:12px;margin:16px 0}
    .btn{border:none;border-radius:12px;padding:14px 16px;font-weight:700;cursor:pointer}
    .btn.wide{width:100%}
    .btn-indigo{background:var(--indigo);color:#fff}
    .btn-pink{background:var(--pink);color:#fff}
    .btn:disabled{background:#cbd5e1;color:#f8fafc;cursor:not-allowed}
    .tabs{display:flex;gap:12px;margin:16px 0}
    .tab{flex:1;display:flex;justify-content:center;align-items:center;padding:14px;border-radius:12px;font-weight:700;cursor:pointer;background:#e5e7eb;color:#374151}
    .tab.active{background:linear-gradient(90deg,var(--indigo),#7c3aed);color:#fff;box-shadow:0 8px 20px rgba(79,70,229,.35)}
    .tab.pink.active{background:linear-gradient(90deg,var(--rose),var(--pink));}
    .pill{display:inline-block;background:var(--indigo);color:#fff;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800}
    .section{border-left:5px solid var(--amber);padding:16px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    details{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
    details summary{cursor:pointer;font-weight:800}
    ul,ol{margin:8px 0 8px 18px}
    .muted{color:var(--muted)}
    .q{background:#f9fafb;border:1px solid var(--border);border-radius:12px;padding:12px;margin:10px 0}
    .q.wrong{background:#fef2f2;border-color:#fecaca}
    .q.right{background:#f0fdf4;border-color:#bbf7d0}
    .radio{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;border:2px solid transparent;margin:8px 0;cursor:pointer}
    .radio.active{border-color:var(--indigo);background:#fff}
    .bank{border:1px dashed var(--border);border-radius:12px;padding:10px;background:#fff}
    textarea,input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);font-size:14px}
    .submitbar{position:sticky;bottom:12px;background:linear-gradient(90deg,#ecfdf5,#f0fdfa);border:4px solid #bbf7d0;padding:18px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .grid{display:grid;gap:12px}
    @media(min-width:800px){.grid2{grid-template-columns:1fr 1fr}}
    .scoreBox{border-left:6px solid #22c55e;padding:14px;border-radius:12px;background:#f0fdf4}
    .scoreBox.warn{border-color:#f59e0b;background:#fffbeb}
    .scoreBox.bad{border-color:#ef4444;background:#fef2f2}
    .small{font-size:12px}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#e5e7eb;margin-left:6px;font-size:12px}
  </style>

</head>
<body>
  <div class="container">
    <div class="card">
      <header style="text-align:center;margin-bottom:16px">
        <h1>üìñ Judaism: Comprehensive Workbook</h1>
        <p class="muted">Study Guide + Assessment with Email Results</p>
      </header>

      <div class="tabs">
        <div class="tab active" id="tab-guide">Study Guide</div>
        <div class="tab pink" id="tab-assessment">Assessment</div>
      </div>

      <div id="view-guide">
        <div class="section" style="margin-bottom:16px;background:linear-gradient(90deg,#4f46e5,#7c3aed);color:#fff;">
          <h2>Part 1 ¬∑ Study Guide</h2>
          <p class="small" style="color:#eef2ff">Read this first. Sections are expandable for quick review.</p>
        </div>

        <details open class="section">
          <summary>Section 1: Origins and History</summary>
          <p>Judaism is one of the world's oldest monotheistic religions, spanning over <strong>3,000 years</strong>. "Monotheistic" means belief in <strong>one God</strong>.</p>
          <div class="grid grid2">
            <div class="bank">
              <h4>Abraham (c. 2000 BCE)</h4>
              <ul>
                <li>Father of the Jewish People</li>
                <li>Covenant (special agreement) with God</li>
                <li>Taught monotheism</li>
              </ul>
            </div>
            <div class="bank">
              <h4>Moses (c. 1300 BCE)</h4>
              <ul>
                <li>Led the Exodus from Egypt</li>
                <li>Received Ten Commandments on Mount Sinai</li>
              </ul>
            </div>
          </div>
          <div class="bank" style="margin-top:10px">
            <h4>Exodus Timeline (summary)</h4>
            <ol>
              <li>Israelites enslaved in Egypt</li>
              <li>Moses: ‚ÄúLet my people go‚Äù</li>
              <li>Ten plagues ‚Üí departure</li>
              <li>Red Sea crossing</li>
              <li>Wilderness (40 years) & Torah at Sinai</li>
            </ol>
            <p class="small muted">Key dates: c.2000 BCE Abraham ¬∑ c.1300 BCE Exodus ¬∑ c.1000 BCE David/Jerusalem ¬∑ 586 BCE First Temple destroyed ¬∑ 70 CE Second Temple destroyed.</p>
          </div>
        </details>

        <details class="section" open>
          <summary>Section 2: Sacred Texts</summary>
          <p><strong>Torah</strong> (‚ÄúTeaching‚Äù): first five books ‚Äî Genesis, Exodus, Leviticus, Numbers, Deuteronomy ‚Äî handwritten on scrolls and read weekly. The <strong>Tanakh</strong> (Hebrew Bible) = Torah + Prophets (Nevi'im) + Writings (Ketuvim). The <strong>Talmud</strong> (Mishnah + Gemara) records rabbinic law, debates, and guidance. Also: <em>Siddur</em> (prayer book), <em>Haggadah</em> (Passover), <em>Midrash</em> (interpretations).</p>
        </details>

        <details class="section" open>
          <summary>Section 3: Core Beliefs</summary>
          <ul>
            <li><strong>Monotheism</strong> ‚Äî God is one, eternal, creator.</li>
            <li><strong>Covenant</strong> ‚Äî special responsibility to follow God‚Äôs laws.</li>
            <li><strong>613 mitzvot</strong> ‚Äî commandments, summarized by the Ten Commandments.</li>
            <li><strong>Ethics</strong>: Tikkun Olam (repair the world), Tzedakah (charity/justice).</li>
          </ul>
        </details>

        <details class="section" open>
          <summary>Section 4: Worship and Community Life</summary>
          <div class="grid grid2">
            <div class="bank">
              <h4>Synagogue</h4>
              <ul>
                <li>Ark (Torah), eternal light, bimah</li>
                <li>Prayer facing Jerusalem</li>
              </ul>
            </div>
            <div class="bank">
              <h4>Rabbi & Prayer</h4>
              <ul>
                <li>Rabbi = teacher/leader</li>
                <li>Daily services: Shacharit, Mincha, Ma'ariv</li>
                <li>Shabbat: Friday sunset ‚Üí Saturday sunset</li>
              </ul>
            </div>
          </div>
        </details>

        <details class="section" open>
          <summary>Section 5: Dietary Laws (Kashrut)</summary>
          <ul>
            <li>No pork/shellfish; fish need fins & scales; split-hooved cud-chewers permitted.</li>
            <li>Separate meat & dairy (no mixing; separate utensils).</li>
            <li>Ritual slaughter; remove blood; look for kosher certification (OU, OK, Star‚ÄëK).</li>
          </ul>
        </details>

        <details class="section" open>
          <summary>Section 6: Festivals and Celebrations</summary>
          <div class="grid grid2">
            <div class="bank">
              <h4>Major Holidays</h4>
              <ul>
                <li><strong>Passover</strong>: Exodus, Seder, matzah</li>
                <li><strong>Rosh Hashanah</strong>: New Year, shofar</li>
                <li><strong>Yom Kippur</strong>: Atonement, fasting</li>
                <li><strong>Hanukkah</strong>: Temple rededication, oil miracle</li>
                <li><strong>Purim</strong>: Esther, costumes, megillah</li>
                <li><strong>Sukkot</strong>: Sukkah, lulav & etrog</li>
                <li><strong>Shavuot</strong>: Torah at Sinai</li>
              </ul>
            </div>
            <div class="bank">
              <h4>Calendar</h4>
              <p>Follows a lunar cycle ‚Äî civil dates vary each year.</p>
            </div>
          </div>
        </details>

        <details class="section" open>
          <summary>Section 7: Symbols of Judaism</summary>
          <div class="grid grid2">
            <div class="bank">
              <ul>
                <li>Star of David (Magen David) ‚ú° ‚Äî identity symbol</li>
                <li>Menorah (7‚Äëbranched) ‚Äî light/wisdom; national symbol</li>
                <li>Hanukkiah (9‚Äëbranched) ‚Äî Hanukkah only</li>
              </ul>
            </div>
            <div class="bank">
              <ul>
                <li>Mezuzah ‚Äî doorpost scroll (Shema)</li>
                <li>Tallit (prayer shawl) & Tefillin (phylacteries)</li>
                <li>Kippah/Yarmulke ‚Äî head covering (respect)</li>
                <li>Chai (◊ó◊ô) ‚Äî ‚Äúlife‚Äù (value 18)</li>
              </ul>
            </div>
          </div>
        </details>

        <details class="section" open>
          <summary>Section 8: Branches of Judaism</summary>
          <ul>
            <li><strong>Orthodox</strong>: most traditional; strict Sabbath/kosher; gender‚Äëseparate seating in many synagogues.</li>
            <li><strong>Conservative</strong>: balance tradition & modernity.</li>
            <li><strong>Reform</strong>: adaptive/egalitarian; emphasis on ethics; equal leadership roles.</li>
            <li>Also Reconstructionist, Humanistic; many identify as ‚ÄúJust Jewish‚Äù.</li>
          </ul>
        </details>

        <div class="section" style="background:linear-gradient(90deg,#059669,#0d9488);color:#fff;margin-top:16px;text-align:center">
          <h3>Ready to Practice?</h3>
          <p>Open the Assessment tab for auto‚Äëgraded questions + written responses.</p>
        </div>
      </div>

      <div id="view-assessment" style="display:none">
        <div class="section" style="background:linear-gradient(90deg,#e11d48,#db2777);color:#fff;">
          <h2>Part 3 ¬∑ Comprehensive Assessment</h2>
          <p class="small">Auto‚Äëgraded: Multiple Choice, True/False, Matching. Written sections are included in the emailed report for teacher review.</p>
          <div class="row" style="justify-content:space-between;align-items:center">
            <div style="display:flex;gap:8px;align-items:center">
              <label for="fromName"><strong>From Name</strong></label>
              <input id="fromName" type="text" placeholder="Student / Parent / Teacher" style="max-width:280px"/>
            </div>
            <div class="small">
              <span id="sendStatus" class="small"></span>
            </div>
          </div>
        </div>

        <div id="scorePanel" class="scoreBox" style="display:none;margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div>
              <div id="scoreText" style="font-weight:800;font-size:20px">Score:</div>
              <div id="scorePct" class="muted"></div>
            </div>
            <div id="scoreTag" class="tag">status</div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="btnRetake" class="btn" style="background:#2563eb;color:#fff;border-radius:10px">Retake</button>
            <a href="#written" class="btn" style="background:#7c3aed;color:#fff;border-radius:10px">Jump to Written</a>
          </div>
        </div>

        <!-- SECTION A: MC -->
        <div class="section">
          <span class="pill">Section A ¬∑ Multiple Choice (2 pts each)</span>
          <div id="mcRoot"></div>
        </div>

        <!-- SECTION B: T/F -->
        <div class="section">
          <span class="pill" style="background:#0d9488">Section B ¬∑ True / False (1 pt each)</span>
          <div id="tfRoot" class="grid grid2"></div>
        </div>

        <!-- SECTION C: Matching -->
        <div class="section">
          <span class="pill" style="background:#e11d48">Section C ¬∑ Matching (2 pts each)</span>
          <div class="grid grid2">
            <div id="matchRoot"></div>
            <div class="bank">
              <p class="muted" style="font-weight:700;margin-bottom:6px">Definition Bank (choose A‚ÄìF)</p>
              <div id="matchBank"></div>
            </div>
          </div>
        </div>

        <!-- Written -->
        <div class="section" id="written">
          <span class="pill" style="background:#f59e0b">Sections D‚ÄìJ ¬∑ Written Responses</span>
          <div id="writtenRoot"></div>
        </div>

        <div class="submitbar">
          <div style="text-align:center">
            <div style="font-weight:800;font-size:20px">Ready to Submit?</div>
            <div class="muted">Auto‚Äëgraded sections answered: <span id="autoStatus" style="font-weight:800;color:#1d4ed8">Incomplete</span></div>
            <div style="height:10px"></div>
            <button id="btnSubmit" class="btn wide" disabled style="background:linear-gradient(90deg,#16a34a,#0d9488);color:#fff">Submit & Email Results</button>
            <div id="sendNote" class="small" style="margin-top:8px"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ==== Tabs ====
    const tabGuide = document.getElementById('tab-guide');
    const tabAssess = document.getElementById('tab-assessment');
    const viewGuide = document.getElementById('view-guide');
    const viewAssess = document.getElementById('view-assessment');

    tabGuide.addEventListener('click', ()=>{
      tabGuide.classList.add('active'); tabAssess.classList.remove('active');
      viewGuide.style.display='block'; viewAssess.style.display='none';
    });
    tabAssess.addEventListener('click', ()=>{
      tabAssess.classList.add('active','pink'); tabGuide.classList.remove('active');
      viewGuide.style.display='none'; viewAssess.style.display='block';
      window.scrollTo({top:0,behavior:'smooth'});
    });

    

    // ==== Data ====
    const MC = {
      q1:{prompt:'Judaism is approximately how old?', options:['1,000 years','2,000 years','3,000 years','5,000 years'], correctIdx:2},
      q2:{prompt:'Who is known as the "Father of the Jewish People"?', options:['Moses','Abraham','David','Isaac'], correctIdx:1},
      q3:{prompt:'Which leader received the Ten Commandments on Mount Sinai?', options:['Abraham','Jacob','Moses','Aaron'], correctIdx:2},
      q4:{prompt:'How many books are in the Torah?', options:['3','5','10','613'], correctIdx:1},
      q5:{prompt:'What is the complete Hebrew Bible called?', options:['Talmud','Torah','Tanakh','Midrash'], correctIdx:2},
      q6:{prompt:'The Talmud is best described as:', options:['The first five books of the Bible','A collection of teachings explaining Jewish law','The Jewish prayer book','A book of psalms'], correctIdx:1},
      q7:{prompt:'What does "monotheism" mean?', options:['Belief in many gods','Belief in no god','Belief in one God','Belief in nature'], correctIdx:2},
      q8:{prompt:'How many commandments (mitzvot) are in the Torah?', options:['10','100','248','613'], correctIdx:3},
      q9:{prompt:'The Jewish place of worship is called a:', options:['Church','Mosque','Synagogue','Cathedral'], correctIdx:2},
      q10:{prompt:'A rabbi is best described as a:', options:['Priest who performs sacrifices','Teacher and community leader','King of the Jewish people','Prophet who predicts the future'], correctIdx:1},
      q11:{prompt:'When is Shabbat observed?', options:['Friday morning to Friday evening','Friday evening to Saturday evening','Saturday morning to Sunday morning','All day Sunday'], correctIdx:1},
      q12:{prompt:'Which of these foods is NOT kosher?', options:['Chicken','Salmon','Shrimp','Beef'], correctIdx:2},
      q13:{prompt:"Why can't Jews mix meat and dairy?", options:["It tastes bad","It's unhealthy","It's forbidden by Jewish dietary law","It's too expensive"], correctIdx:2},
      q14:{prompt:'Which holiday celebrates freedom from slavery in Egypt?', options:['Hanukkah','Purim','Passover','Rosh Hashanah'], correctIdx:2},
      q15:{prompt:'What is eaten during Passover instead of regular bread?', options:['Challah','Matzah','Pita','Crackers'], correctIdx:1},
      q16:{prompt:'Rosh Hashanah is:', options:['The Day of Atonement','The Jewish New Year','The Festival of Lights','A harvest festival'], correctIdx:1},
      q17:{prompt:'What is Yom Kippur known for?', options:['Eating a big feast','Lighting candles for 8 nights','Fasting and asking forgiveness','Wearing costumes'], correctIdx:2},
      q18:{prompt:'How many nights is Hanukkah celebrated?', options:['3','7','8','10'], correctIdx:2},
      q19:{prompt:'Which holiday involves reading the Book of Esther?', options:['Passover','Purim','Sukkot','Shavuot'], correctIdx:1},
      q20:{prompt:'The Star of David is:', options:['A five-pointed star','A six-pointed star','A seven-pointed star','An eight-pointed star'], correctIdx:1},
      q21:{prompt:'What is a mezuzah?', options:['A prayer shawl','A head covering','A small box with prayers on a doorpost','A type of food'], correctIdx:2},
      q22:{prompt:'Which branch of Judaism is the most traditional?', options:['Reform','Conservative','Orthodox','Reconstructionist'], correctIdx:2},
      q23:{prompt:'Which branch allows women to become rabbis?', options:['Only Reform and Conservative','Only Orthodox','All branches','No branches'], correctIdx:0},
      q24:{prompt:'What does "tzedakah" mean?', options:['Prayer','Charity/justice','Holiday','Food'], correctIdx:1},
      q25:{prompt:'The covenant in Judaism is:', options:['A special agreement between God and the Jewish people','A type of prayer','A holiday celebration','A dietary law'], correctIdx:0}};
    const TF = {
      q26:{prompt:'Judaism was the first major religion to teach monotheism.', correct:true},
      q27:{prompt:'The Exodus refers to the Jews leaving Babylonia.', correct:false},
      q28:{prompt:'Genesis is the first book of the Torah.', correct:true},
      q29:{prompt:'There are exactly 10 commandments in the Torah.', correct:false},
      q30:{prompt:'The Talmud is older than the Torah.', correct:false},
      q31:{prompt:'Jews believe they are chosen for special responsibility.', correct:true},
      q32:{prompt:'Tikkun Olam means "destroy the world."', correct:false},
      q33:{prompt:'Jews pray facing toward Jerusalem.', correct:true},
      q34:{prompt:'Pork is allowed if prepared in a special way.', correct:false},
      q35:{prompt:'Meat and dairy can be eaten together in kosher law.', correct:false},
      q36:{prompt:'Passover lasts for one day only.', correct:false},
      q37:{prompt:'On Yom Kippur, Jews fast for 25 hours.', correct:true},
      q38:{prompt:'Hanukkah commemorates the Exodus from Egypt.', correct:false},
      q39:{prompt:'A sukkah is a temporary hut built during Sukkot.', correct:true},
      q40:{prompt:'The menorah originally had nine branches.', correct:false},
      q41:{prompt:'Orthodox Judaism is more flexible than Reform Judaism.', correct:false},
      q42:{prompt:'Women and men sit separately in many Orthodox synagogues.', correct:true},
      q43:{prompt:'Conservative Judaism tries to balance tradition with modernity.', correct:true},
      q44:{prompt:'A kippah is worn on the head as a sign of respect.', correct:true},
      q45:{prompt:'The Torah scroll is printed like a regular bound book.', correct:false}};
    const MATCH_BANK = {
      A: 'Day of Atonement, fasting, asking forgiveness',
      B: 'Jewish New Year, new beginnings',
      C: 'Freedom from slavery in Egypt',
      D: 'Miracle of oil, religious freedom',
      E: 'Saving of Jews in Persia, Queen Esther',
      F: 'Harvest, remembering desert journey'};
    const MATCHING = {
      q46:{left:'Passover', correct:'C'},
      q47:{left:'Rosh Hashanah', correct:'B'},
      q48:{left:'Yom Kippur', correct:'A'},
      q49:{left:'Hanukkah', correct:'D'},
      q50:{left:'Purim', correct:'E'},
      q51:{left:'Sukkot', correct:'F'}};
    const WRITTEN = [
      {id:'q52', prompt:'Explain why Abraham is important in Judaism.', rows:4},
      {id:'q53', prompt:'What is the Torah and why is it so important to Jews?', rows:4},
      {id:'q54', prompt:'Describe what happens during a Passover Seder.', rows:4},
      {id:'q55', prompt:'Difference between the seven‚Äëbranched menorah and the Hanukkah menorah.', rows:4},
      {id:'q56', prompt:'Why do Jews keep kosher? Provide at least two reasons.', rows:4},
      {id:'q57', prompt:'Significance of Shabbat in Jewish life.', rows:4},
      {id:'q58', prompt:'Describe a Bar or Bat Mitzvah and its importance.', rows:4},
      {id:'q59', prompt:'List the Five Books of the Torah.', rows:3},
      {id:'q60', prompt:'List four Jewish holidays.', rows:3},
      {id:'q61', prompt:'List three foods that are NOT kosher.', rows:3},
      {id:'q62', prompt:'List the three main branches of Judaism.', rows:3},
      {id:'q63', prompt:'Define: Monotheism.', rows:2},
      {id:'q64', prompt:'Define: Covenant.', rows:2},
      {id:'q65', prompt:'Define: Mitzvot.', rows:2},
      {id:'q66', prompt:'Define: Synagogue.', rows:2},
      {id:'q67', prompt:'Define: Rabbi.', rows:2},
      {id:'q68', prompt:'Define: Kosher.', rows:2},
      {id:'q69', prompt:'Essay: Explain the story of the Exodus and its importance (5‚Äì7 sentences).', rows:7},
      {id:'q70', prompt:'Essay: Compare Orthodox and Reform Judaism (5‚Äì7 sentences).', rows:7},
      {id:'q71', prompt:'Essay: Describe Hanukkah ‚Äî history, celebration, meaning (5‚Äì7 sentences).', rows:7},
      {id:'q72', prompt:'Essay: What does it mean to keep kosher? Key rules and purposes (5‚Äì7 sentences).', rows:7},
      {id:'q73', prompt:'Critical Thinking: Three specific examples of Tikkun Olam in daily life.', rows:5},
      {id:'q74', prompt:'Critical Thinking: Why has Judaism survived for 3,000+ years?', rows:5},
      {id:'q75', prompt:'Critical Thinking: How do branches show evolution with core identity?', rows:5},
      {id:'q76', prompt:"Application: Describe what you'd observe at a Shabbat dinner.", rows:5},
      {id:'q77', prompt:'Application: Explain kosher to respect a classmate‚Äôs practice.', rows:5},
      {id:'q78', prompt:'Visual: Describe three Jewish symbols and their meanings (draw on paper).', rows:5},
      {id:'q79', prompt:'Bonus: What does the word ‚ÄúIsrael‚Äù mean in Judaism?', rows:3},
      {id:'q80', prompt:'Bonus: Name a famous Jewish person and why they are significant.', rows:3},
    ];

    // ==== State ====
    const state = {
      mc:{}, tf:{}, match:{}, written:{},
      submitted:false, points:0, possible:0, percent:0, incorrect:[]
    };

    // ==== Renderers ====
    function renderMC(){
      const root = document.getElementById('mcRoot');
      root.innerHTML = '';
      let i=0;
      for(const [id,q] of Object.entries(MC)){
        i++;
        const wrap = document.createElement('div');
        wrap.className = 'q';
        if(state.submitted){
          const picked = state.mc[id];
          if(picked !== undefined){
            wrap.className = 'q ' + (picked===q.correctIdx?'right':'wrong');
          }
        }
        const head = document.createElement('div');
        head.innerHTML = `<span class="pill">Q${i}</span>`;
        wrap.appendChild(head);
        const prompt = document.createElement('p');
        prompt.style.fontWeight='700';
        prompt.textContent = q.prompt;
        wrap.appendChild(prompt);
        q.options.forEach((opt,idx)=>{
          const label = document.createElement('label'); label.className='radio';
          if(state.mc[id]===idx) label.classList.add('active');
          label.innerHTML = `<input type="radio" name="${id}"/> <span>${opt}</span>`;
          label.addEventListener('click',()=>{ if(!state.submitted){ state.mc[id]=idx; renderMC(); updateSubmitState(); } });
          wrap.appendChild(label);
        });
        if(state.submitted && state.mc[id]!==q.correctIdx){
          const corr = document.createElement('div');
          corr.className='small muted';
          corr.innerHTML = `<strong>Correct:</strong> ${q.options[q.correctIdx]}`;
          wrap.appendChild(corr);
        }
        root.appendChild(wrap);
      }
    }

    function renderTF(){
      const root = document.getElementById('tfRoot'); root.innerHTML='';
      let base = 25;
      let i=0;
      for(const [id,q] of Object.entries(TF)){
        i++;
        const wrap = document.createElement('div');
        wrap.className='q';
        if(state.submitted){
          const picked = state.tf[id];
          if(picked !== undefined){
            wrap.className = 'q ' + (picked===q.correct?'right':'wrong');
          }
        }
        const head = document.createElement('div');
        head.innerHTML = `<span class="pill" style="background:#0d9488">Q${base+i}</span>`;
        wrap.appendChild(head);
        const prompt = document.createElement('p'); prompt.style.fontWeight='700'; prompt.textContent=q.prompt; wrap.appendChild(prompt);
        [true,false].forEach(val=>{
          const label = document.createElement('label'); label.className='radio';
          if(String(state.tf[id])===String(val)) label.classList.add('active');
          label.innerHTML = `<input type="radio" name="${id}"/> <span style="font-weight:700">${val?'True':'False'}</span>`;
          label.addEventListener('click',()=>{ if(!state.submitted){ state.tf[id]=val; renderTF(); updateSubmitState(); } });
          wrap.appendChild(label);
        });
        if(state.submitted && state.tf[id]!==q.correct){
          const corr = document.createElement('div'); corr.className='small muted';
          corr.innerHTML = `<strong>Correct:</strong> ${q.correct?'True':'False'}`; wrap.appendChild(corr);
        }
        root.appendChild(wrap);
      }
    }

    function renderMatching(){
      const root = document.getElementById('matchRoot'); root.innerHTML='';
      let base=45; let i=0;
      for(const [id,q] of Object.entries(MATCHING)){
        i++;
        const wrap = document.createElement('div'); wrap.className='q';
        const a = (state.match[id]||'').toUpperCase();
        if(state.submitted && a){ wrap.className = 'q ' + (a===q.correct?'right':'wrong'); }
        const row = document.createElement('div');
        row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px';
        row.innerHTML = `<span class="pill" style="background:#e11d48">Q${base+i}</span><strong>${q.left} ‚Üí</strong>`;
        const inp = document.createElement('input'); inp.type='text'; inp.placeholder='A‚ÄìF'; inp.style.maxWidth='60px'; inp.value=a;
        inp.addEventListener('input', e=> { if(!state.submitted){ state.match[id] = e.target.value; updateSubmitState(); } });
        row.appendChild(inp); wrap.appendChild(row);
        if(state.submitted && a && a!==q.correct){
          const corr = document.createElement('div'); corr.className='small muted'; corr.innerHTML = `<strong>Correct:</strong> ${q.correct} ¬∑ ${MATCH_BANK[q.correct]}`; wrap.appendChild(corr);
        }
        root.appendChild(wrap);
      }
      const bankRoot = document.getElementById('matchBank'); bankRoot.innerHTML='';
      for(const [letter,text] of Object.entries(MATCH_BANK)){
        const d = document.createElement('div'); d.style.display='flex'; d.style.gap='8px'; d.style.marginBottom='4px';
        d.innerHTML = `<strong style="width:20px">${letter}.</strong><span>${text}</span>`; bankRoot.appendChild(d);
      }
    }

    function renderWritten(){
      const root = document.getElementById('writtenRoot'); root.innerHTML='';
      let base=51; let i=0;
      WRITTEN.forEach(w=>{
        i++;
        const wrap = document.createElement('div'); wrap.className='q';
        const head = document.createElement('div'); head.innerHTML = `<span class="pill" style="background:#f59e0b">Q${base+i}</span>`; wrap.appendChild(head);
        const p = document.createElement('p'); p.style.fontWeight='700'; p.textContent = w.prompt; wrap.appendChild(p);
        const ta = document.createElement('textarea'); ta.rows = w.rows||3; ta.placeholder='Type your response‚Ä¶'; ta.value = state.written[w.id]||'';
        ta.addEventListener('input', e=>{ state.written[w.id] = e.target.value; });
        wrap.appendChild(ta);
        root.appendChild(wrap);
      });
    }

    // ==== Scoring & Submit ====
    function formatWrong(id, prompt, your, correct){
      return `(${id}) ${prompt}\n  Your answer: ${your}\n  Correct answer: ${correct}`;
    }

    function recomputeScore(){
      let correct=0, pts=0, possible=0; const wrong=[];
      // MC
      for(const [id,q] of Object.entries(MC)){
        possible += 2;
        const a = state.mc[id];
        if(a === q.correctIdx){ correct++; pts+=2; }
        else if(a !== undefined){ wrong.push(formatWrong(id,q.prompt, q.options[a], q.options[q.correctIdx])); }
      }
      // TF
      for(const [id,q] of Object.entries(TF)){
        possible += 1;
        const a = state.tf[id];
        if(a === q.correct){ correct++; pts+=1; }
        else if(a !== undefined){ wrong.push(formatWrong(id,q.prompt, a?'True':'False', q.correct?'True':'False')); }
      }
      // Matching
      for(const [id,q] of Object.entries(MATCHING)){
        possible += 2;
        const a = (state.match[id]||'').trim().toUpperCase();
        if(a === q.correct){ correct++; pts+=2; }
        else if(a){ wrong.push(formatWrong(id, `${q.left} ‚Üí ?`, a, `${q.correct}: ${MATCH_BANK[q.correct]}`)); }
      }
      state.points = pts; state.possible = possible; state.percent = Math.round((pts/possible)*100); state.incorrect = wrong;
    }

    function updateSubmitState(){
      const auto = allAutoAnswered();
      document.getElementById('autoStatus').textContent = auto ? 'All' : 'Incomplete';
      const btn = document.getElementById('btnSubmit');
      btn.disabled = !auto;
    }

    function allAutoAnswered(){
      // MC answered
      for(const id of Object.keys(MC)){ if(typeof state.mc[id] === 'undefined') return false; }
      // TF
      for(const id of Object.keys(TF)){ if(typeof state.tf[id] === 'undefined') return false; }
      // Match
      for(const id of Object.keys(MATCHING)){ if(!String(state.match[id]||'').trim()) return false; }
      return true;
    }

    function showScorePanel(){
      const panel = document.getElementById('scorePanel'); panel.style.display='block';
      const scoreText = document.getElementById('scoreText'); scoreText.textContent = `Score: ${state.points}/${state.possible} points`;
      const scorePct = document.getElementById('scorePct'); scorePct.textContent = `${state.percent}%`;
      const tag = document.getElementById('scoreTag');
      panel.classList.remove('warn','bad');
      if(state.percent>=90){ tag.textContent='Outstanding'; }
      else if(state.percent>=75){ tag.textContent='Good'; panel.classList.add('warn'); }
      else { tag.textContent='Keep practicing'; panel.classList.add('bad'); }
    }

    function buildEmailMessage(){
      const lines = [
        'Assessment: Judaism ‚Äî Comprehensive',
        `Score: ${state.points}/${state.possible} (${state.percent}%)`,
        ''
      ];
      if(state.incorrect.length){
        lines.push('Incorrect items (with correct answers):');
        state.incorrect.forEach(x=>lines.push('- '+x));
      } else {
        lines.push('All auto‚Äëgraded items are correct ‚Äî excellent!');
      }
      lines.push('', 'Written Responses (for review):');
      WRITTEN.forEach(w=>{
        const val = (state.written[w.id]||'').trim() || '‚Äî';
        lines.push(`‚Ä¢ ${w.prompt}\n  Response: ${val}`);
      });
      return lines.join('\n');
    }

    // ==== Init render ====
    renderMC(); renderTF(); renderMatching(); renderWritten(); updateSubmitState();

    // Retake
    document.getElementById('btnRetake').addEventListener('click', ()=>{
      state.submitted=false; state.points=0; state.possible=0; state.percent=0; state.incorrect=[];
      state.mc={}; state.tf={}; state.match={}; // keep written as is
      document.getElementById('scorePanel').style.display='none';
      renderMC(); renderTF(); renderMatching(); updateSubmitState();
      window.scrollTo({top:0,behavior:'smooth'});
    });

    // Submit
    document.getElementById('btnSubmit').addEventListener('click', async ()=>{
      state.submitted = true;
      recomputeScore();
      renderMC(); renderTF(); renderMatching(); showScorePanel();
      window.scrollTo({top:0,behavior:'smooth'});

      // Email
      const fromName = (document.getElementById('fromName').value || 'Judaism Assessment').trim();
      const message = buildEmailMessage();
      const sendStatus = document.getElementById('sendStatus');
      const sendNote = document.getElementById('sendNote');
      sendStatus.textContent = 'Sending results‚Ä¶';
      sendNote.textContent = '';
      try{
        const resp = await 
        sendStatus.textContent = '‚úÖ Results emailed successfully.';
        sendNote.textContent = `Sent to: ${EMAIL.TO_EMAIL}`;
      }catch(err){
        sendStatus.textContent = '‚ùå Email sending failed.';
        sendNote.textContent = (err && (err.text || err.message)) ? (err.text || err.message) : 'Please verify EmailJS keys/service/template in this file.';
      }
    });
  </script>
</body>
</html>
